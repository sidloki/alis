<template>
  <require from="./home.css"></require>
  <ons-page>
    <ons-toolbar modifier="" class="searchbar">
      <div class="left">
      </div>
      <div class="center">
        <ons-toolbar-button click.delegate="showMenu()">
          <ons-icon icon="ion-navicon, material:md-menu"></ons-icon>
        </ons-toolbar-button>
        <div style="flex:1" click.delegate="showSearch()">
          <input type="search" class="search-input" placeholder="Höranlage suchen..." value.bind="searchText" />
        </div>
        <ons-toolbar-button if.bind="searchText" click.delegate="clearSearch()">
          <ons-icon icon="ion-ios-close-empty, material:md-close"></ons-icon>
        </ons-toolbar-button>
      </div>
      <div class="right">
      </div>
    </ons-toolbar>
    <div style="display:flex;flex-direction:column;height:100%;">
      <div ref="_map" style="flex:1;width:100%;"></div>
      <div show.bind="selection" style="position:relative;max-height:60%;height:auto;z-index:10000;display:flex;" ref="roomlist">
        <ons-button style="position:fixed;right:0;left:auto;margin-top:-16px;z-index:10000;" modifier="quiet">
          <ons-icon icon="ion-record,material:md-circle" size="2x" style="color:#fff;"></ons-icon>
        </ons-button>
        <ons-button click.trigger="deselect()" style="position:fixed;right:0;left:auto;margin-top:-16px;z-index:10001;" modifier="quiet">
          <ons-icon icon="ion-ios-close,material:md-close-circle" size="2x"></ons-icon>
        </ons-button>
        <ons-list style="flex:1;overflow-y:scroll;">
          <template if.bind="selection.rooms.length === 1">
            <ons-list-header if.bind="selection.name && selection.name !== getRoomName(selection.rooms[0])">
              <span>${selection.name}</span>
            </ons-list-header>
            <template repeat.for="org of selection.organisations">
              <ons-list-item repeat.for="room of org.rooms" tappable click.trigger="showRoom(room)" style="margin-bottom:0px;">
                <span class="list-item__title">
                  <span>${getRoomName(room)}</span>
                </span>
                <span class="list-item__subtitle" if.bind="room.organisation">
                  <span>${room.organisation}</span>
                </span>
              </ons-list-item>
            </template>
          </template>
          <template if.bind="selection.rooms.length > 1">
            <ons-list-header if.bind="selection.name">
              <span>${selection.name}</span>
            </ons-list-header>
              <template repeat.for="org of selection.organisations">
                <ons-list-item repeat.for="room of org.rooms" tappable click.trigger="showRoom(room)" style="margin-bottom:0px;">
                  <span class="list-item__title">
                    <span>${getRoomName(room)}</span>
                  </span>
                  <span class="list-item__subtitle" if.bind="room.organisation">
                    <span>${room.organisation}</span>
                  </span>
                </ons-list-item>
              </template>
          </template>
        </ons-list>
      </div>
      <!-- <ons-bottom-toolbar show.bind="!selection" style="position:relative;">
        <div style="line-height:44px;padding:0 16px;" click.trigger="showList()">
            Liste anzeigen
        </div>
      </ons-bottom-toolbar> -->
    </div>
  </ons-page>
    <ons-modal ref="_search">
      <ons-page>
        <ons-toolbar modifier="transparent" class="searchbar">
          <div class="left">
          </div>
          <div class="center">
            <ons-toolbar-button click.delegate="cancelSearch()">
              <ons-icon icon="ion-ios-arrow-back, material:md-arrow-left"></ons-icon>
            </ons-toolbar-button>
            <form style="flex:1;" submit.delegate="onSearch()">
              <input ref="_searchinput" type="search" class="search-input" placeholder="Höranlage suchen..." value.bind="currentSearchText" input.trigger="onSearchInput()" />
            </form>
            <ons-toolbar-button show.bind="currentSearchText" click.delegate="clearCurrentSearch()">
              <ons-icon icon="ion-ios-close-empty, material:md-close"></ons-icon>
            </ons-toolbar-button>
          </div>
          <div class="right">
          </div>
        </ons-toolbar>
        <div class="card" if.bind="!currentSearchText">
          <div style="display:flex;flex-wrap:wrap;align-items:flex-start;">
            <div class="category-item" repeat.for="category of db.data.roomtypes">
              <div style="padding:10px 5px;" click.delegate="searchCategory(category)">
                <ons-button style="width:48px;height:48px;border-radius:100%;line-height:48px;padding:0;">
                  <ons-icon icon="fa-deaf" size="24px"></ons-icon>
                </ons-button>
                <div class="category-label">${category.typ}</div>
              </div>
            </div>
          </div>
        </div>
        <div class="card" style="padding:0;" if.bind="currentSearchText">
          <ons-list>
            <ons-list-item repeat.for="location of currentResults.locations" tappable modifier="longdivider" click.delegate="onLocationResultClick(location)">
              <div class="left"></div>
              <div class="center">
                <span class="list-item__title">${location.name}</span>
              </div>
            </ons-list-item>
            <template repeat.for="building of currentResults.buildings">
              <ons-list-item repeat.for="org of building.organisations" tappable modifier="longdivider" click.delegate="onBuildingResultClick(building)">
                <div class="left"></div>
                <div class="center">
                  <span class="list-item__title">${building.name || org.name}</span>
                  <span class="list-item__subtitle">
                    <span if.bind="building.name">${org.name}</span>
                    <br if.bind="building.name"/>
                    <span>${building.strasse_nr}, ${building.plz} ${building.ort}</span>
                  </span>
                </div>
              </ons-list-item>
            </template>
          </ons-list>
        </div>
      </ons-page>
    </ons-modal>
</template>
