<template>
  <require from="./home.css"></require>
  <ons-page>
    <ons-toolbar modifier="" class="searchbar">
      <div class="left">
      </div>
      <div class="center">
        <ons-toolbar-button click.delegate="showMenu()">
          <ons-icon icon="ion-navicon, material:md-menu"></ons-icon>
        </ons-toolbar-button>
        <div style="flex:1" click.delegate="showSearch()">
          <input type="search" class="search-input" placeholder="Höranlage suchen..." value.bind="searchText" />
        </div>
        <ons-toolbar-button if.bind="searchText" click.delegate="clearSearch()">
          <ons-icon icon="ion-ios-close-empty, material:md-close"></ons-icon>
        </ons-toolbar-button>
      </div>
      <div class="right">
      </div>
    </ons-toolbar>
    <div style="display:flex;flex-direction:column;height:100%;">
      <div ref="_map" style="flex:1;width:100%;"></div>
      <div show.bind="selection" style="position:relative;max-height:60%;height:auto;z-index:10000;display:flex;" ref="roomlist">
        <ons-button style="position:fixed;right:0;left:auto;margin-top:-16px;z-index:10000;" modifier="quiet">
          <ons-icon icon="ion-record,material:md-circle" size="2x" style="color:#fff;"></ons-icon>
        </ons-button>
        <ons-button click.trigger="deselect()" style="position:fixed;right:0;left:auto;margin-top:-16px;z-index:10001;" modifier="quiet">
          <ons-icon icon="ion-ios-close,material:md-close-circle" size="2x"></ons-icon>
        </ons-button>
        <ons-list style="flex:1;overflow-y:scroll;">
          <template if.bind="selection.systems.length === 1">
            <ons-list-header if.bind="selection.name && selection.name !== selection.systems[0].name">
              <span>${selection.name}</span>
            </ons-list-header>
            <ons-list-item repeat.for="system of selection.systems" tappable click.trigger="showInfo(system)" style="margin-bottom:0px;">
              <span class="list-item__title">
                <span>${system.name}</span>
              </span>
              <span class="list-item__subtitle" if.bind="system.organisation.name">
                <span>${system.organisation.name}</span>
              </span>
            </ons-list-item>
          </template>
          <template if.bind="selection.systems.length > 1">
            <ons-list-header if.bind="selection.name">
              <span>${selection.name}</span>
            </ons-list-header>
              <ons-list-item repeat.for="system of selection.systems" tappable click.trigger="showInfo(system)" style="margin-bottom:0px;">
                <span class="list-item__title">
                  <span>${system.name}</span>
                </span>
                <span class="list-item__subtitle" if.bind="system.organisation.name">
                  <span>${system.organisation.name}</span>
                </span>
              </ons-list-item>
          </template>
        </ons-list>
      </div>
    </div>
  </ons-page>
    <ons-modal ref="_search">
      <ons-page>
        <ons-toolbar modifier="transparent" class="searchbar">
          <div class="left">
          </div>
          <div class="center">
            <ons-toolbar-button click.delegate="cancelSearch()">
              <ons-icon icon="ion-ios-arrow-back, material:md-arrow-left"></ons-icon>
            </ons-toolbar-button>
            <form style="flex:1;" submit.delegate="onSearch()">
              <input ref="_searchinput" type="search" class="search-input" placeholder="Höranlage suchen..." value.bind="currentSearchText" input.trigger="onSearchInput()" />
            </form>
            <ons-toolbar-button show.bind="currentSearchText" click.delegate="clearCurrentSearch()">
              <ons-icon icon="ion-ios-close-empty, material:md-close"></ons-icon>
            </ons-toolbar-button>
          </div>
          <div class="right">
          </div>
        </ons-toolbar>
        <div class="card" if.bind="!currentSearchText">
          <div style="display:flex;flex-wrap:wrap;align-items:flex-start;">
            <div class="category-item" repeat.for="category of categories">
              <div style="padding:10px 5px;" click.delegate="searchCategory(category)">
                <ons-button css="width:48px;height:48px;border-radius:100%;line-height:48px;padding:0;background-color:${category.icon.color};">
                  <span class="category ons-icon ${category.icon.prefix} ${category.icon.prefix}-${category.icon.name}"></span>
                </ons-button>
                <div class="category-label">${category.typ}</div>
              </div>
            </div>
          </div>
        </div>
        <div style="padding:0 10px;" if.bind="currentSearchText && searchExec && currentResults.locations.length === 0 && currentResults.systems.length === 0">
          <p>
            Für den eingegebenen Suchbegriffe wurde leider nichts gefunden.
          </p>
        </div>
        <div class="card" style="padding:0;" if.bind="currentSearchText">
          <ons-list>
            <ons-list-item repeat.for="location of currentResults.locations" tappable modifier="longdivider" click.delegate="onLocationResultClick(location)">
              <div class="left"></div>
              <div class="center">
                <span class="list-item__title">${location.name}</span>
              </div>
            </ons-list-item>
            <ons-list-item repeat.for="system of currentResults.systems" tappable modifier="longdivider" click.delegate="onResultClick(system)">
              <div class="left"></div>
              <div class="center">
                <span class="list-item__title">${system.building.name || system.organisation.name}</span>
                <span class="list-item__subtitle">
                  <span if.bind="system.building.name">${system.organisation.name}</span>
                  <br if.bind="system.building.name"/>
                  <span>${system.building.strasse_nr}, ${system.building.plz} ${system.building.ort}</span>
                </span>
              </div>
            </ons-list-item>
          </ons-list>
        </div>
      </ons-page>
    </ons-modal>
</template>
